{
  "name": "p_radio",
  "cargo_dependencies": [],
  "files": [
    {
      "name": "p_radio.rs",
      "content": "use leptos::{\n    html::{AnyElement, Input},\n    *,\n};\nuse leptos_use::{use_element_size, UseElementSizeReturn};\nuse wasm_bindgen::{JsCast, JsValue};\nuse web_sys::{\n    js_sys::{Array, Function, JsString, Object, Reflect},\n    Event, EventInit, MouseEvent,\n};\n\nuse crate::registry::primitives::{\n    p_presence::create_presence, p_primitive::Primitive, p_utils_create_previous::create_previous,\n    Attributes,\n};\n\n#[derive(Clone)]\nstruct RadioContextValue {\n    checked: Signal<bool>,\n    disabled: Signal<bool>,\n}\n\n#[component]\npub fn Radio(\n    #[prop(optional, into)] value: MaybeSignal<String>,\n    #[prop(optional, into)] checked: MaybeSignal<bool>,\n    #[prop(optional, into)] required: MaybeSignal<bool>,\n    #[prop(default=(|_|{}).into(), into)] on_check: Callback<()>,\n    #[prop(default=(|_|{}).into(), into)] on_click: Callback<MouseEvent>,\n\n    #[prop(optional, into)] disabled: MaybeSignal<bool>,\n    #[prop(optional, into)] name: MaybeProp<String>,\n\n    #[prop(optional)] node_ref: NodeRef<AnyElement>,\n    #[prop(attrs)] attrs: Attributes,\n    children: ChildrenFn,\n\n    #[prop(optional, into)] as_child: MaybeProp<bool>,\n) -> impl IntoView {\n    let (is_form_control, set_is_form_control) = create_signal(true);\n    let has_consumer_stopped_propagation = StoredValue::new(false);\n\n    Effect::new(move |_| {\n        set_is_form_control.set(if let Some(form) = node_ref.get() {\n            form.closest(\"form\").ok().flatten().is_some()\n        } else {\n            true\n        });\n    });\n\n    provide_context(RadioContextValue {\n        checked: Signal::derive(move || checked.get()),\n        disabled: Signal::derive(move || disabled.get()),\n    });\n\n    view! {\n        <Primitive\n            {..attrs}\n            attr:type=\"button\"\n            attr:role=\"radio\"\n            attr:aria-checked=move || checked.get().to_string()\n            attr:data-state=move || { if checked.get() { \"checked\" } else { \"unchecked\" } }\n            attr:data-disabled=disabled\n            attr:disabled=move || disabled.get().then_some(\"\")\n            attr:value=value.clone()\n            element=html::button\n            on:click=move |ev: MouseEvent| {\n                leptos::Callable::call(&on_click, ev.clone());\n                if !checked.get() {\n                    leptos::Callable::call(&on_check, ());\n                }\n                if is_form_control.get() && !has_consumer_stopped_propagation.get_value() {\n                    ev.stop_propagation();\n                }\n            }\n            node_ref=node_ref\n            as_child=as_child\n        >\n            {children()}\n        </Primitive>\n\n        <Show when=move || is_form_control.get()>\n            <BubbleInput\n                checked=Signal::derive(move || checked.get())\n                bubbles=Signal::derive(move || !has_consumer_stopped_propagation.get_value())\n                name=name.clone()\n                value=value.clone()\n                required=Signal::derive(move || required.get())\n                disabled=Signal::derive(move || disabled.get())\n                control=node_ref\n            />\n        </Show>\n    }\n}\n\n#[component]\npub fn RadioIndicator(\n    #[prop(optional, into)] force_mount: MaybeSignal<bool>,\n\n    #[prop(optional)] node_ref: NodeRef<AnyElement>,\n    #[prop(attrs)] attrs: Attributes,\n    children: ChildrenFn,\n\n    #[prop(optional, into)] as_child: MaybeProp<bool>,\n) -> impl IntoView {\n    let RadioContextValue {\n        checked,\n        disabled,\n    } = use_context().expect(\"RadioIndicator must be used in a Radio component\");\n\n    let is_present = Signal::derive(move || force_mount.get() || checked.get());\n    let presence = create_presence(is_present, node_ref);\n\n    let children = StoredValue::new(children);\n\n    view! {\n        <Show when=move || presence.get()>\n            <Primitive\n                {..attrs.clone()}\n                attr:data-state=move || { if checked.get() { \"checked\" } else { \"unchecked\" } }\n                attr:data-disabled=disabled\n                element=html::span\n                node_ref=node_ref\n                as_child=as_child\n            >\n                {children.with_value(|children| children())}\n            </Primitive>\n        </Show>\n    }\n}\n\n#[component]\nfn BubbleInput(\n    checked: Signal<bool>,\n    bubbles: Signal<bool>,\n    #[prop(into)] name: MaybeProp<String>,\n    value: MaybeSignal<String>,\n    required: Signal<bool>,\n    disabled: Signal<bool>,\n    control: NodeRef<AnyElement>,\n    #[prop(attrs)] attrs: Attributes,\n) -> impl IntoView {\n    let node_ref = NodeRef::<Input>::new();\n    let prev_checked = create_previous(Signal::derive(move || checked.get()));\n    let UseElementSizeReturn {\n        width,\n        height,\n    } = use_element_size(control);\n\n    Effect::new(move |_| {\n        (|| {\n            let input = node_ref.get()?;\n            let input_el = window().get(\"HTMLInputElement\")?;\n            let input_proto = Reflect::get(&input_el, &JsString::from(\"prototype\"))\n                .ok()?\n                .dyn_into::<Object>()\n                .ok()?;\n\n            let input_descriptor_set = Reflect::get(\n                &Object::get_own_property_descriptor(&input_proto, &JsString::from(\"checked\")),\n                &JsString::from(\"set\"),\n            )\n            .ok()?\n            .dyn_into::<Function>()\n            .ok()?;\n\n            if prev_checked.get() != checked.get() {\n                let ev_options = EventInit::new();\n                ev_options.set_bubbles(bubbles.get());\n\n                let ev = Event::new_with_event_init_dict(\"click\", &ev_options).ok()?;\n\n                _ = Reflect::apply(\n                    &input_descriptor_set,\n                    &input,\n                    &Array::from_iter([JsValue::from_bool(checked.get())]),\n                );\n\n                _ = input.dispatch_event(&ev);\n            }\n\n            Some(())\n        })();\n    });\n\n    view! {\n        <input\n            type=\"checkbox\"\n            aria-hidden\n            name=name.into_attribute()\n            value=value.into_attribute()\n            required=required.into_attribute()\n            disabled=disabled.into_attribute()\n            checked=checked.into_attribute()\n            tabindex=(-1).into_attribute()\n            node_ref=node_ref\n            style:position=\"absolute\"\n            style:pointer-events=\"none\"\n            style:opacity=\"0\"\n            style:margin=\"0\"\n            style:width=move || width.get()\n            style:height=move || height.get()\n            {..attrs}\n        />\n    }\n}\n"
    }
  ],
  "type": "components:primitives/",
  "type_short": "components:primitives"
}